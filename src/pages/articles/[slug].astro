 ---
  import Layout from '../../layouts/Layout.astro';
  import { format } from 'date-fns';
  import { marked } from 'marked';
  import { db } from '../../db/index';
  import { articles } from '../../db/schema';
  import { eq, desc } from 'drizzle-orm';

  export async function getStaticPaths() {
    const allArticles = await db
      .select()
      .from(articles)
      .where(eq(articles.published, true))
      .orderBy(desc(articles.createdAt));

    return allArticles.map((article) => ({
      params: { slug: article.slug },
      props: { article },
    }));
  }

  const { article } = Astro.props;

  const htmlContent = marked(article.content);
  ---

 <Layout title={article.title} description={article.content.substring(0, 160)}>
    <nav style="margin-bottom: 2rem;">
      <a href="/" style="color: #666;">‚Üê Back to all articles</a>
    </nav>

    <article>
      <header style="margin-bottom: 2rem; border-bottom: 2px solid var(--color-border); padding-bottom: 1rem;">
        <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">{article.title}</h1>
        <time style="color: #666; font-size: 0.9rem;">
          {format(new Date(article.createdAt), 'MMMM d, yyyy')}
        </time>
      </header>

      <div set:html={htmlContent} style="
        font-size: 1.1rem;
        line-height: 1.8;
      " />
    </article>

    <style>
      /* Style the markdown content */
      article div :global(h1),
      article div :global(h2),
      article div :global(h3) {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }

      article div :global(p) {
        margin-bottom: 1rem;
      }

      article div :global(code) {
        background: #f4f4f4;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-size: 0.9em;
      }

      article div :global(pre) {
        background: #f4f4f4;
        padding: 1rem;
        border-radius: 5px;
        overflow-x: auto;
        margin-bottom: 1rem;
      }

      article div :global(pre code) {
        background: none;
        padding: 0;
      }
    </style>
  </Layout> 