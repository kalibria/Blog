---
  import Layout from '../layouts/Layout.astro';
  import { format } from 'date-fns';
  import type { Article} from '../types/article';
  import { db } from '../db/index';
  import { articles } from '../db/schema';
  import { eq, desc } from 'drizzle-orm';


const publishedArticles = await db
    .select({
      id: articles.id,
      title: articles.title,
      slug: articles.slug,
      content: articles.content,
      createdAt: articles.createdAt,
      updatedAt: articles.updatedAt,
    })
    .from(articles)
    .where(eq(articles.published, true))
    .orderBy(desc(articles.createdAt));
  
  ---

  <Layout title="My Blog" description="Welcome to my blog built with Astro and SST">
    <header style="margin-bottom: 3rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">My Blog</h1>
      <p style="color: #666;">Thoughts on web development, serverless, and more</p>
    </header>

    <section>
      {publishedArticles.length === 0 ? (
        <p style="color: #666;">No articles published yet.</p>
      ) : (
        <div style="display: flex; flex-direction: column; gap: 2rem;">
          {publishedArticles.map((article) => (
            <article style="border-bottom: 1px solid var(--color-border); padding-bottom: 2rem;">
              <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem;">
                <a href={`/articles/${article.slug}`}>{article.title}</a>
              </h2>
              <time style="color: #666; font-size: 0.9rem;">
                {format(new Date(article.createdAt), 'MMMM d, yyyy')}
              </time>
              <p style="margin-top: 1rem; color: #555;">
                {article.content.substring(0, 200)}...
              </p>
              <a href={`/articles/${article.slug}`} style="display: inline-block; margin-top: 0.5rem;">
                Read more â†’
              </a>
            </article>
          ))}
        </div>
      )}
    </section>
  </Layout>
